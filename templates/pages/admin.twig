{% extends "layout.twig" %}

{% block content %}



<div class="row" id="admin-panel">
	<div id="admin-title" class="col-lg-12">
    	<h1>Administration</h1>
    </div>
    <div id="admin-sidebar" class="col-lg-2">
    	<div id="profile-wrapper">
    		<img src="uploads/avatar/SOku/avatar_soku_01-55-31.jpg" class="rounded-circle" height="100" width="auto" />
    	</div>
    	<nav id="admin-nav" class="navbar bg-light">
    		<ul class="nav nav-pills">
    			<li class="nav-item">
    				<a class="nav-link active" href="#dashboard-admin-tab" data-toggle="pill">Tableau de bord</a>
    			<li class="nav-item">
    				<a class="nav-link" href="#reports-wrapper" data-toggle="pill">Signalements</a>
    			</li>
    			<li class="nav-item">
    				<a class="nav-link" href="#edit-tab" role="tab" data-toggle="pill">Moderation</a>
    			</li>
    			<li class="nav-item">
    				<a class="nav-link" href="#members-tab" data-toggle="pill">Membres</a>
    			</li>
    			<li class="nav-item">
    				<a class="nav-link" href="#logs-tab" data-toggle="pill">Logs</a>
    			</li>
    		</ul>
    	</nav>
    </div>
    <div class="col-lg-10 tab-content admin-tab">
    	<div id="dashboard-admin-tab" class="tab-pane fade show active" role="tabpanel">
    		<div class="row">
    			<div class="col-lg-12">
    				<div class="dashboard-title">
        				<i class="fas fa-chart-area"></i>
        				<h2>Statistiques</h2>
    				</div>
    				<div class="admin-hr"></div>
    			</div>
    		</div>
    		<div class="row d-flex justify-content-between">
    			<div class="border-top my-3"></div>
    			<div id="stats-photos" class="col-lg-3 dashboard-card card-stats">
    				<span class="photos-count">
    					<i class="fas fa-images"></i>
    					{{ totalPhoto }}
    				</span>
    				<p>photos</p>
    			</div>
    			<div id="stats-comments" class="col-lg-3 dashboard-card card-stats">
    				<span class="comments-count">
    					<i class="fas fa-comments"></i>
    					{{ commentsNbr }}
    				</span>
    				<p>commentaires</p>
    			</div>
    			<div id="stats-likes" class="col-lg-3 dashboard-card card-stats">
    				<span class="likes-count">
    					<i class="fas fa-heart"></i>
    					{{ likesNbr }}
    				</span>
    				<p>mention j'aime</p>
    			</div>
    		</div>
    		<div class="row">
    			<div class="col-lg-12">
    				<div class="dashboard-title">
        				<i class="fas fa-tools"></i>
        				<h2>Outils</h2>
    				</div>
    				<div class="admin-hr"></div>
    			</div>
    		</div>
    		<div class="row">
    			<div class="col-lg-8 dashboard-card">
    				<p>Signalements</p>
    			</div>
    			<div class="col-lg-3 dashboard-card">
    				<div class="dashboard-card-title">
    					<h4>Zone de Quarantaine</h4>
    				</div>
        			<div class="dashboard-card-body">
            			<p>Il y a 15 images placées en quarantaine</p>
        			</div>
        			<div class="button-wrapper">
        				<a href="admin/clearquar" class="btn btn-primary">Vider ?</a>
        			</div>
    			</div>
    		</div>
    	</div>
        <div id="reports-wrapper" class="tab-pane fade show" role="tabpanel">
        	{% if not reportsNbr %}
        		<div class="empty-div">
        			<img src="images/question_mark.png" alt="empty-content">
        			<p>Il n'y a pas de signalements !</p>
        		</div>
        	{% endif %}
    	    {% if reportsNbr == 1 %}
            	<div class="alert alert-warning">
            		<i class="fas fa-exclamation-triangle"></i>
            		<span>Il y a {{ reportsNbr }} signalement reporté par la communauté</span>
            	</div>
           	{% elseif reportsNbr > 1 %}
           		<div class="alert alert-danger">
            		<i class="fas fa-exclamation-triangle"></i>
            		<span>Il y a {{ reportsNbr }} signalements reportés par la communauté</span>
            	</div>
            {% endif %}
            {% if reportsNbr > 0 %}
            	<div id="img-report-wrapper" class="d-flex justify-content-around flex-row flex-wrap">
            	<span id="clear-btn">
            		<a href="admin/clear">Vider<i class="fas fa-times"></i></a>
            	</span>
            	{% for posts in reportedPosts %}
            		<div class="card img-single-report">
            			<div class="image-reported-wrapper">
            				<img class="card-img-top image-reported" src="uploads/photos/{{ posts.filename }}" />
            			</div>
            			<div class="card-body img-info-panel">
            				<div class="alert alert-warning">Cette image a éte reportée {{ posts.reported }} fois</div>
            				<h2 class="card-title">{{ posts.name }}</h2>
            				<div class="admin-btn-panel">
            					<div class="admin-btn-container">
                					<form id="getreport" method="POST" action="admin/getreport">
                        				<input type="hidden" id="imgId" class="imgId" name="postId" value="{{ posts.id }}" />
                        				<button class="admin-btn edit" href="#edit-tab" role="tab" data-toggle="pill">
                        					<i class="fas fa-edit"></i>Editer post
                        				</button>
                    				</form>
                				</div>
            					<div class="admin-btn-container">
                        			<form id="deleteImg" method="POST" action="admin/delete">
                    					<input type="hidden" id="imgId" class="imgId" name="postId" value="{{ posts.id }}" />
                    					<button class="admin-btn delete">
                    						<i class="fas fa-trash-alt"></i>Supprimer post
                    					</button>
                					</form>
            					</div>
            				</div>
            			</div>
            		</div>
            	{% endfor %}
            	</div>
            {% endif %}
    	</div>
    	<div class="tab-pane fade" id="edit-tab" role="tabpanel">
    		<div class="row">
    			<div class="col-lg-12">
    				<h3>Editer un post</h3>
    			</div>
    		</div>
    		<div class="row">
    			<div class="col-lg-6">
        			<div id="admin-edit-wrapper">
                		<form id="editPost" method="POST" action="admin/edit" >
                			<div class="form-group">
                				<label for="name">Titre</label>
                				<input id="name" type="text" class="form-control" name="name">
                			</div>
                			<div class="form-group">
                				<label for="author">Auteur</label>
                				<input id="author" class="form-control" type="text" name="author" readonly>
                			</div>
                			<div class="form-group">
                				<label for="content">Description</label>
                				<textarea class="form-control" id="description" name="description" rows="2"></textarea>
                			</div>
                			<input type="hidden" id="edit-imgId" name="postId" />
                			<button type="submit" href="#edit-tab" class="btn btn-primary">Editer le Post</button>
                		</form>
            		</div>
            	</div>
        		<div class="col-lg-6" id="edit-preview"></div>
    		</div>
    	</div>
    	<div id="members-tab" class="tab-pane fade" role="tabpanel">
    		<div id="members-tab-header">
    			<h3><i class="fas fa-users"></i><span id="member-count"></span> Membres</h3>
    			<span id="members-sort" class="admin-pill">
    				Plus récent
    				<i class="fas fa-chevron-down"></i>
    			</span>
    		</div>
    		<div id="members-card-wrapper">
        		{% for members in membersList %}
        		<div class="member-card">
        			{% if members.avatar_file == NULL %}
        			<div class="avatar-wrapper">
                		<img src="uploads/avatar/avatar_default.png" class="avatar-mini" alt="{{ members.name }} avatar" height="60" width="auto">
                	</div>
                	{% else %}
                	<div class="avatar-wrapper">
                		<img src="uploads/avatar/{{ members.name }}/{{ members.avatar_file }}" alt="{{ members.name }} avatar" height="60" width="auto">
                	</div>
                	{% endif %}
        			<h4>{{ members.name }}</h4>
        			<p>Inscrit le : {{ members.date_fr }}</p>
        		</div>
    		    {% endfor %}
    		    <div class="pagination-wrapper">
			    <nav aria-label="Page navigation example">
              		<ul class="pagination">
                		<li class="page-item {% if currentPage == 1 %}disabled{% endif %}"><a class="page-link" href="admin?page={{ previousPage }}">Précédent</a></li>
                            {% for i in range(1, totalPages) %}
                			<li class="page-item {% if currentPage == i %}active{% endif %}"><a class="page-link" href="admin?page={{ i }}">{{ i }}</a></li>
                            {% endfor %}
                		<li class="page-item {% if currentPage == totalPages %}disabled{% endif %}"><a class="page-link" href="admin?page={{ nextPage }}">Suivant</a></li>
              		</ul>
        		</nav>
    			</div>
    		</div>
    	</div>
    	<div id="logs-tab" class="tab-pane fade" role="tabpanel">
			<h3><i class="fas fa-clipboard-list"></i>Logs modération</h3>
		    {% for logs in logs %}
			<div class="logs-card">
				<h4>{{ logs.old_name }}</h4>
				<p>{{ logs.old_content }}</p>
			</div>
		    {% endfor %}
    	</div>
	</div>
</div>

<div id="overlay" class="overlay">
	<div class="row">
		<div id="admin-image-wrapper" class="col-lg-8 mx-auto">
    		<span class="icon-exit" id="cross-admin">
        		<i class="fas fa-times"></i>
        	</span>
		</div>
	</div>
</div>

{% endblock %}